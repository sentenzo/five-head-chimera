version: "3"

services:

  frontend:
    image: fhc/frontend
    build:
      context: frontend
    ports:
      - 8888:80
    depends_on:
      - backend
    volumes:
      - ./frontend/static:/app/static:ro

  backend:
    image: fhc/backend
    ports:
      - 9999:8000 # if changing local port, also change the URL in frontend/static/script.js
    build:
      context: ./backend
    environment:
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - rabbitmq
    volumes:
      - ./backend/service:/usr/src/app:ro

  rabbitmq:
    image: fhc/rabbitmq
    build:
      context: ./rabbitmq
    ports:
      - 5672:5672
      - 15672:15672 # the default user:pass is guest:guest
    depends_on:
      - dbwriter
    volumes:
      - ./.docker-volumes/rabbitmq/data/:/var/lib/rabbitmq
      - ./.docker-volumes/rabbitmq/log/:/var/log/rabbitmq

  dbwriter:
    image: fhc/dbwriter
    build:
      context: ./dbwriter
    depends_on:
      - db

  db:
    image: fhc/db
    build:
      dockerfile: ./db/Dockerfile
    environment:
      - POSTGRES_DB=feedback
      - POSTGRES_PASSWORD=hackme
    ports:
      - 6789:5432
    volumes:
      - ./.docker-volumes/db:/var/lib/postgresql/data
